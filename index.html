<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diagnostic Immo - Saisie Clavier</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: #f0f2f5;
            padding: 15px;
            color: #1a1a1a;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .header {
            background: #2563eb;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .input-section { padding: 20px; }
        
        label {
            display: block;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 14px;
            color: #4b5563;
        }

        /* Optimisation pour mobile : focus clair et grande zone de saisie */
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px; /* √âvite le zoom auto sur iOS */
            font-family: inherit;
            margin-bottom: 15px;
            transition: border-color 0.2s;
        }
        textarea:focus {
            outline: none;
            border-color: #2563eb;
            background: #f8faff;
        }

        .btn-add {
            width: 100%;
            background: #059669;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }

        .preview-area {
            background: #f9fafb;
            padding: 15px;
            border-top: 1px solid #eee;
            font-size: 13px;
        }

        .chip {
            display: inline-block;
            background: #dcfce7;
            color: #166534;
            padding: 3px 8px;
            border-radius: 6px;
            margin: 2px;
            font-weight: 500;
        }

        .table-section { padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; font-size: 12px; color: #6b7280; padding: 8px; border-bottom: 2px solid #eee; }
        td { padding: 12px 8px; border-bottom: 1px solid #f3f4f6; font-size: 14px; }
        
        .btn-del { background: #fee2e2; color: #ef4444; border: none; padding: 5px 10px; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>Logiciel Diagnostic</h2>
        <p>Utilisez le micro du clavier üéôÔ∏è</p>
    </div>

    <div class="input-section">
        <label for="mainInput">Cliquez ci-dessous et utilisez la dict√©e du clavier :</label>
        <textarea id="mainInput" placeholder="Ex: B√¢timent A, 2 chambres, un salon, une cuisine..."></textarea>
        <button class="btn-add" onclick="processEntry()">‚úÖ Valider et ajouter</button>
    </div>

    <div id="preview" class="preview-area">
        <em>Aper√ßu en temps r√©el...</em>
    </div>

    <div class="table-section">
        <h3>Inventaire des pi√®ces</h3>
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Localisation</th>
                    <th>D√©signation</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    const PIECES_LIST = {
        'chambre': 'Chambre',
        'salon': 'Salon',
        'sejour': 'S√©jour',
        'cuisine': 'Cuisine',
        'salle de bain': 'Salle de Bain',
        'sdb': 'Salle de Bain',
        'wc': 'WC',
        'toilettes': 'WC',
        'entree': 'Entr√©e',
        'couloir': 'Couloir',
        'palier': 'Palier',
        'garage': 'Garage',
        'balcon': 'Balcon',
        'terrasse': 'Terrasse'
    };

    const NUMBERS = { 'un': 1, 'une': 1, 'deux': 2, 'trois': 3, 'quatre': 4, 'cinq': 5, 'six': 6 };

    function normalize(str) {
        return str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    function parseText(text) {
        const norm = normalize(text);
        
        // 1. Extraction Localisation (simplifi√©e)
        let location = "Parties Privatives";
        const locMatch = text.match(/(B√¢timent|B√¢t|Logement|Appart)\s+\w+/i);
        if (locMatch) location = locMatch[0];

        // 2. Extraction des pi√®ces et gestion des quantit√©s
        let results = [];
        const segments = norm.split(/,| et |puis/);

        segments.forEach(seg => {
            for (let [key, label] of Object.entries(PIECES_LIST)) {
                if (seg.includes(key)) {
                    // Chercher un nombre avant la pi√®ce
                    let quantity = 1;
                    const words = seg.trim().split(/\s+/);
                    const idx = words.findIndex(w => w.includes(key));
                    
                    if (idx > 0) {
                        const prevWord = words[idx-1];
                        if (NUMBERS[prevWord]) quantity = NUMBERS[prevWord];
                        else if (!isNaN(parseInt(prevWord))) quantity = parseInt(prevWord);
                    }

                    // G√©n√©ration num√©rot√©e (Chambre 1, Chambre 2...)
                    if (quantity > 1) {
                        for (let i = 1; i <= quantity; i++) {
                            results.push({ loc: location, name: `${label} ${i}` });
                        }
                    } else {
                        results.push({ loc: location, name: label });
                    }
                    break; // √âvite de trouver "salle de bain" et "bain"
                }
            }
        });
        return results;
    }

    function updateUI() {
        const text = document.getElementById('mainInput').value;
        const preview = document.getElementById('preview');
        const data = parseText(text);

        if (!text) {
            preview.innerHTML = "<em>En attente de saisie...</em>";
            return;
        }

        preview.innerHTML = data.map(d => `<span class="chip">${d.name}</span>`).join(' ');
    }

    document.getElementById('mainInput').addEventListener('input', updateUI);

    function processEntry() {
        const text = document.getElementById('mainInput').value;
        const data = parseText(text);
        const tbody = document.getElementById('tableBody');

        data.forEach(item => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${item.loc}</td>
                <td contenteditable="true">${item.name}</td>
                <td><button class="btn-del" onclick="this.parentElement.parentElement.remove()">üóëÔ∏è</button></td>
            `;
        });

        document.getElementById('mainInput').value = "";
        updateUI();
    }
</script>

</body>
</html>
